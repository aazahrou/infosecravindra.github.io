<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><meta content=#fff name=theme-color><meta content="How to use queues in Laravel" name=description><meta content=" laravel,  queues,  '" name=keywords><meta content="Ravindra Sisodia" name=author><meta content="How to Use Queues in Laravel: Ravindra's Blog" property=og:title><meta content=https://infosecravindra.github.io/laravel/queues/2019/04/07/how-to-use-queues-in-laravel.html property=og:url><meta content="Ravindra's Blog" property=og:site_name><meta content=article property=og:type><meta content="How to use queues in Laravel" property=og:description><meta content="Ravindra Sisodia" property=article:author><meta content=laravel property=article:tag><meta content=queues property=article:tag><meta content=2019-05-12T13:50:16Z property=article:published_time><meta content=https://infosecravindra.github.io/assets/images/posts/laravel/how-to-use-queues-in-laravel.webp property=og:image itemprop=image><meta content=222225015360700 property=fb:app_id><title>How to Use Queues in Laravel | Ravindra's Blog</title><link href=/manifest.json rel=manifest><link href=https://fonts.gstatic.com/ rel=preconnect><link href=/assets/images/logo.webp rel=icon><link href=https://use.fontawesome.com/releases/v5.8.2/css/solid.css rel=stylesheet crossorigin=anonymous integrity=sha384-ioUrHig76ITq4aEJ67dHzTvqjsAP/7IzgwE7lgJcg2r7BRNGYSK0LwSmROzYtgzs><link href=https://use.fontawesome.com/releases/v5.8.2/css/brands.css rel=stylesheet crossorigin=anonymous integrity=sha384-i2PyM6FMpVnxjRPi0KW/xIS7hkeSznkllv+Hx/MtYDaHA5VcF0yL3KVlvzp8bWjQ><link href=https://use.fontawesome.com/releases/v5.8.2/css/fontawesome.css rel=stylesheet crossorigin=anonymous integrity=sha384-sri+NftO+0hcisDKgr287Y/1LVnInHJ1l+XC7+FOabmTTIK0HnE2ID+xxvJ21c5J><link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel=stylesheet><link href=/assets/css/all.css rel=stylesheet></head><body class=layout-post><nav class="bg-white fixed-top mediumnavigation nav-down navbar navbar-expand-lg navbar-light shadow-sm"><div class="container pr-0"><a href=/ class=navbar-brand><img alt="Ravindra's Blog" class="align-top d-inline-block" src=/assets/images/logo.webp height=30 width=30>Ravindra's Blog</a><button aria-controls=navbarMediumish aria-expanded=false aria-label="Toggle navigation" class="btn-link navbar-toggler" data-target=#navbarMediumish data-toggle=collapse><span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarMediumish><ul class="ml-auto navbar-nav"><li class=nav-item><a href=/index.html class=nav-link><i class="fas fa-home"></i>&nbsp;&nbsp;Home</a></li><li class=nav-item><a href=/cheatsheets class=nav-link><i class="fas fa-book"></i>&nbsp;&nbsp;Cheatsheets</a></li><li class=nav-item><a href=/portfolio class=nav-link><i class="fas fa-user"></i>&nbsp;&nbsp;Projects</a></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" aria-expanded=false aria-haspopup=true data-toggle=dropdown id=navbarDropdown role=button><i class="fa-address-card far"></i>&nbsp;&nbsp;Contact</a><div class=dropdown-menu aria-labelledby=navbarDropdown><a href=mailto:rscipher001@gmail.com class=nav-link rel=noopener target=_blank><i class="fas fa-envelope"></i>&nbsp;&nbsp;Mail</a><div class=dropdown-divider></div><a href=https://www.github.com/InfoSecRavindra/ class=nav-link rel=noopener target=_blank><i class="fab fa-github"></i>&nbsp;&nbsp;GitHub</a><a href=https://www.linkedin.com/in/InfoSecRavindra/ class=nav-link rel=noopener target=_blank><i class="fab fa-linkedin"></i>&nbsp;&nbsp;LinkedIn</a><a href=https://www.youtube.com/c/EcoTechClubETC class=nav-link rel=noopener target=_blank><i class="fab fa-youtube"></i>&nbsp;&nbsp;YouTube</a><div class=dropdown-divider></div><a href=https://twitter.com/InfoSecRavindra class=nav-link rel=noopener target=_blank><i class="fab fa-twitter"></i>&nbsp;&nbsp;Twitter</a></div></li></ul></div></div></nav><div class=site-content><div class=container><div class=mainheading><h1 class=sitetitle>Ravindra's Blog</h1><p class=lead>Let's Secure Everything</p></div><div class=main-content><div class=container><div class=row><div class="col-md-2 pl-0"><div class=share><p>Share</p><ul><li class="ml-1 mr-1"><a href="https://facebook.com/sharer.php?u=https://infosecravindra.github.io/laravel/queues/2019/04/07/how-to-use-queues-in-laravel.html" target=_blank onclick="window.open(this.href, 'facebook-share');return false;"><i class="fab fa-facebook-f"></i></a></li><li class="ml-1 mr-1"><a href="https://twitter.com/intent/tweet?text=How+to+Use+Queues+in+Laravel&url=https://infosecravindra.github.io/laravel/queues/2019/04/07/how-to-use-queues-in-laravel.html" target=_blank onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a href="https://www.linkedin.com/shareArticle?mini=true&url=https://infosecravindra.github.io/laravel/queues/2019/04/07/how-to-use-queues-in-laravel.html" target=_blank onclick="window.open(this.href, 'linkedin-share');return false;"><i class="fab fa-linkedin-in"></i></a></li></ul><div class=sep></div><ul><li><a href=#disqus_thread class="small smoothscroll"></a></li></ul></div></div><div class="col-md-9 flex-first flex-md-unordered"><div class=mainheading><h1 class=posttitle>How to Use Queues in Laravel</h1></div><img alt="How to Use Queues in Laravel" class="featured-image img-fluid" src=https://infosecravindra.github.io/assets/images/posts/laravel/how-to-use-queues-in-laravel.webp><div class=article-post><h1 id=introduction>Introduction</h1><p>Concept of queues is awesome but learning queues can be little bit confusing for some users because you’ve to do a lot of things to get things working like create jobs and choose drivers and start queue workers but don’t worry, when you will understand everything about queues life will be more easier. Let’s get started</p><h1 id=steps>Steps</h1><ul><li>Choose a driver</li><li>Create a table for queues</li><li>Create a mail and sent it without queue(for demonstration)</li><li>Create a job for sending mails in background</li><li>Start queue worker</li><li>Sending data to jobs</li></ul><h1 id=choose-a-driver>Choose a driver</h1><p>A driver defines how are we going to store and dispatch jobs in queues, don’t worry about it we are going to use database for this post, you are free to use any other driver like<code class=highlighter-rouge>redis</code>but don’t use<code class=highlighter-rouge>sync</code>, open your<code class=highlighter-rouge>.env</code>file and change<code class=highlighter-rouge>QUEUE_DRIVER</code>to<code class=highlighter-rouge>database</code></p><h1 id=create-a-table-for-queues>Create a table for queues</h1><p>We will store queues in database so we need a table, To create queues table open terminal and type<code class=highlighter-rouge>php artisan queue:table</code>and then<code class=highlighter-rouge>php artisan migrate</code>, it will create jobs table in the database.</p><h1 id=create-a-mail>Create a mail</h1><p>We are going to use mail example so let’s create a mail by running the following command</p><div class="highlighter-rouge language-bash"><div class=highlight><pre class=highlight><code>php artisan make:mail HelloMail <span class=nt>-m</span> mail.hello
</code></pre></div></div><p>and set mailtrap config in your<code class=highlighter-rouge>.env</code>file, to preview a mail without sending add this to your<code class=highlighter-rouge>web.php</code>and visit<code class=highlighter-rouge>/mail/hello</code></p><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nx>App\Mail\HelloMail</span><span class=p>;</span>

<span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>'mail/hello'</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
	<span class=k>return</span> <span class=p>(</span><span class=k>new</span> <span class=nx>HelloMail</span><span class=p>);</span>
<span class=p>});</span>
</code></pre></div></div><p>To send mail for testing add this lines to your web.php</p><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nx>App\Mail\HelloMail</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Mail</span><span class=p>;</span>

<span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>'mail/hello/send'</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
	<span class=nx>Mail</span><span class=o>::</span><span class=na>to</span><span class=p>(</span><span class=s1>'johndoe@example.com'</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>send</span><span class=p>(</span><span class=k>new</span> <span class=nx>HelloMail</span><span class=p>);</span>
<span class=p>});</span>
</code></pre></div></div><p>If you will visit<code class=highlighter-rouge>/mail/hello/send</code>it will send an email synchronously so it will take some time, We are going to minimize that time by creating a job that handles time consuming tasks in background.</p><p>You can also open tinker and type<code class=highlighter-rouge>Mail::to('johndoe@example.com')-&gt;send(new HelloMail);</code>to send mail.</p><h1 id=create-a-job>Create a job</h1><p>To create a job run the following command in your terminal</p><div class="highlighter-rouge language-bash"><div class=highlight><pre class=highlight><code>php artisan make:job SendHelloEmail
</code></pre></div></div><p>now open<code class=highlighter-rouge>app/Jobs/SendHelloMail.php</code>and edit<code class=highlighter-rouge>handle()</code>method and copy paste the following code</p><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nx>App\Mail\HelloMail</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Mail</span><span class=p>;</span>

<span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>()</span>
<span class=p>{</span>
	<span class=nx>Mail</span><span class=o>::</span><span class=na>to</span><span class=p>(</span><span class=s1>'johndoe@example.com'</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>send</span><span class=p>(</span><span class=k>new</span> <span class=nx>HelloMail</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></div><p>As you can see it is same line from<code class=highlighter-rouge>web.php</code>for sending email.</p><p>Now come back to your<code class=highlighter-rouge>web.php</code>and add these lines to create a new route that will send email by using job.</p><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nx>App\Jobs\SendHelloEmail</span><span class=p>;</span>

<span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>'mail/hello/send/job'</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
	<span class=nx>dispatch</span><span class=p>(</span><span class=k>new</span> <span class=nx>SendHelloEmail</span><span class=p>);</span>
<span class=p>});</span>
</code></pre></div></div><p>and visit to<code class=highlighter-rouge>mail/hello/send/job</code>and it will add a new job for sending email but it will not send email, you can verify this by going to jobs table in the database.</p><h1 id=start-queue-worker>Start queue worker</h1><p>To run the queue worker open terminal and type<code class=highlighter-rouge>php artisan queue:work</code>and it will start processing all pending jobs from jobs table, you can see output on the screen.</p><h1 id=sending-data-to-the-jobs>Sending data to the jobs</h1><p>In this example you can see that<code class=highlighter-rouge>johndoe@example.com</code>is hardcoded as email recipient but we need to pass it dynamically in real world apps, for that we are going to use Job constructor, I am not going to explain anything, following code snippet will do the job</p><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=c1>// web.php</span>
<span class=k>use</span> <span class=nx>App\Jobs\SendHelloEmail</span><span class=p>;</span>

<span class=nx>Route</span><span class=o>::</span><span class=na>get</span><span class=p>(</span><span class=s1>'mail/hello/send/job'</span><span class=p>,</span> <span class=k>function</span> <span class=p>()</span> <span class=p>{</span>
	<span class=nx>dispatch</span><span class=p>(</span><span class=k>new</span> <span class=nx>SendHelloEmail</span><span class=p>(</span><span class=s1>'real-email@example.com'</span><span class=p>));</span>
<span class=p>});</span>
</code></pre></div></div><div class="highlighter-rouge language-php"><div class=highlight><pre class=highlight><code><span class=c1>// SendHelloEmail.php</span>

<span class=k>protected</span> <span class=nv>$email</span><span class=p>;</span>

<span class=k>public</span> <span class=k>function</span> <span class=nf>__construct</span><span class=p>(</span><span class=nv>$email</span><span class=p>)</span>
<span class=p>{</span>
	<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>email</span> <span class=o>=</span> <span class=nv>$email</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>public</span> <span class=k>function</span> <span class=nf>handle</span><span class=p>()</span>
<span class=p>{</span>
	<span class=nx>Mail</span><span class=o>::</span><span class=na>to</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>email</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>send</span><span class=p>(</span><span class=k>new</span> <span class=nx>HelloMail</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div></div></div><hr><p><span>Original:&nbsp;<time datetime=2019-04-07>07 Apr 2019</time></span><span class="clearfix float-right">Updated:&nbsp;<time datetime=2019-05-12>May 12, 2019</time></span></p><hr><div class=after-post-tags><ul class=tags><li><a href=/archives/posts_archive.html#laravel class=post-tag>laravel</a></li><li><a href=/archives/posts_archive.html#queues class=post-tag>queues</a></li></ul></div><div class="row PageNavigation d-flex font-weight-bold justify-content-between"><a href=https://infosecravindra.github.io/laravel/vue/pug/2019/03/19/how-to-use-pug-in-vue-template-with-laravel.html class="col-md-6 d-block prev">&laquo; Pug in Vue template with Laravel</a><a href=https://infosecravindra.github.io/laravel/intervention/2019/04/08/how-to-resize-user-uploaded-images-in-laravel.html class="col-md-6 d-block next text-lg-right">How to Resize Images in Laravel &raquo;</a><div class=clearfix></div></div></div></div></div><div class=container><div class="row justify-content-center mb-5" id=comments><div class="col-md-9 col-offset-1"><div id=disqus_thread></div><script src=/assets/js/disqus.js></script><noscript>Please enable JavaScript to view the<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></div></div></div><footer class=footer><div class=container><div class="row text-dark"><div class="col-md-6 col-sm-6 text-center text-lg-left">Copyright © 2019 Ravindra Sisodia</div><div class="col-md-6 col-sm-6 text-center text-lg-right"><a href=https://www.wowthemes.net class=text-dark rel=noopener target=_blank>Mediumish Theme</a>by WowThemes.net</div></div></div></footer></div><script src=https://code.jquery.com/jquery-3.3.1.min.js defer crossorigin=anonymous integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js defer crossorigin=anonymous integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM></script><script src=/assets/js/mediumish.js defer></script><script src=//infosecravindra-github-io.disqus.com/count.js defer id=dsq-count-scr></script><script src=/assets/js/service-worker-handler.js defer></script></body></html>